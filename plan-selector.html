<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Plan Selector | Gideon Code Works</title>
  <meta name="description" content="Get personalized recommendations for your website and digital presence needs">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="images/gcw-logo.png" type="image/png">
</head>
<body class="bg-black text-white min-h-screen">

  <!-- Header & Navigation -->
  <header>
    <div class="fixed w-full top-0 z-50">
      <nav class="site-nav bg-black bg-opacity-95 backdrop-blur-sm border-b border-cyan-500 border-opacity-30" role="navigation" aria-label="Main navigation">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-20">
            <div class="flex-shrink-0 flex items-center">
              <a href="index.html" aria-label="Gideon Code Works Home" class="flex items-center">
                <img src="images/gcw-logo.png" alt="Gideon Code Works logo - cyberpunk tech design with cyan to magenta gradient" width="200" height="60">
              </a>
            </div>

            <div class="nav-desktop-links items-center space-x-6">
              <a href="services.html#web" class="nav-link text-white hover:text-cyan-400">Web Services</a>
              <a href="https://platform.gideoncode.com" target="_blank" rel="noopener noreferrer" class="nav-link text-white hover:text-cyan-400">CRM Platform</a>
              <a href="portfolio.html" class="nav-link text-white hover:text-cyan-400">Portfolio</a>
              <a href="blog.html" class="nav-link text-white hover:text-cyan-400">Blog</a>
              <div class="relative nav-dropdown-container">
                <button type="button" class="nav-link text-white hover:text-cyan-400 flex items-center gap-1 nav-dropdown-toggle" aria-haspopup="true" aria-controls="nav-more-menu">
                  <span>More</span>
                  <svg class="w-4 h-4 text-cyan-400 nav-dropdown-icon transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div id="nav-more-menu" class="nav-dropdown" role="menu" aria-hidden="true">
                  <div class="nav-dropdown-panel">
                    <a href="careers.html" class="nav-dropdown-link px-4 py-2 text-sm text-gray-300 hover:text-cyan-300 hover:bg-cyan-500/10 transition" role="menuitem">Join Sales Team</a>
                    <a href="about.html" class="nav-dropdown-link px-4 py-2 text-sm text-gray-300 hover:text-cyan-300 hover:bg-cyan-500/10 transition" role="menuitem">About</a>
                    <a href="contact.html" class="nav-dropdown-link px-4 py-2 text-sm text-gray-300 hover:text-cyan-300 hover:bg-cyan-500/10 transition" role="menuitem">Contact</a>
                    <a href="services.html#faq" class="nav-dropdown-link px-4 py-2 text-sm text-gray-300 hover:text-cyan-300 hover:bg-cyan-500/10 transition" role="menuitem">FAQ</a>
                  </div>
                </div>
              </div>
              <a href="get-started.html" class="neon-button text-sm py-2 px-4" aria-label="Get started with your website project">Get Started</a>
            </div>

            <div class="nav-mobile-toggle">
              <button id="mobile-menu-button" class="text-cyan-400 focus:outline-none focus:ring-2 focus:ring-cyan-400" aria-label="Toggle mobile menu">
                <div class="hamburger">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu fixed border-l border-cyan-500 border-opacity-30 shadow-2xl" role="menu">
          <div class="flex flex-col p-6 space-y-6">
            <a href="index.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Home</a>
            <a href="services.html#web" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Web Services</a>
            <a href="https://platform.gideoncode.com" target="_blank" rel="noopener noreferrer" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">CRM Platform</a>
            <a href="portfolio.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Portfolio</a>
            <a href="blog.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Blog</a>
            <a href="about.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">About</a>
            <a href="contact.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Contact</a>
            <a href="careers.html" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">Join Sales Team</a>
            <a href="services.html#faq" class="mobile-menu-link text-white hover:text-cyan-400 text-lg" role="menuitem">FAQ</a>
            <a href="get-started.html" class="mobile-menu-link neon-button text-sm py-2 px-4 text-center" role="menuitem">Get Started</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">

      <!-- Intro Section -->
      <div id="intro-section" class="text-center mb-12">
        <div class="inline-block mb-6">
          <div class="text-6xl mb-4">ü§ñ</div>
        </div>
        <h1 class="text-4xl sm:text-5xl font-bold gradient-text mb-4">
          AI Plan Selector
        </h1>
        <p class="text-gray-300 text-lg mb-8">
          Answer a few quick questions and get personalized recommendations for your digital presence
        </p>
        <button onclick="startQuestionnaire()" class="neon-button text-lg px-8 py-4">
          Get Started
        </button>
      </div>

      <!-- Questionnaire Section -->
      <div id="questionnaire-section" class="hidden">
        <!-- Progress Bar -->
        <div class="mb-8">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm text-gray-400">Progress</span>
            <span class="text-sm text-cyan-400"><span id="current-question">1</span> of <span id="total-questions">5</span></span>
          </div>
          <div class="w-full bg-gray-800 rounded-full h-2">
            <div id="progress-bar" class="bg-gradient-to-r from-cyan-500 to-magenta-500 h-2 rounded-full transition-all duration-300" style="width: 20%"></div>
          </div>
        </div>

        <!-- Question Container -->
        <div class="cyber-card mb-6">
          <h2 id="question-text" class="text-2xl font-bold text-white mb-6"></h2>
          <div id="options-container" class="space-y-4"></div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between">
          <button id="back-button" onclick="previousQuestion()" class="neon-button-outline px-6 py-3 opacity-50 pointer-events-none">
            ‚Üê Back
          </button>
          <button id="next-button" onclick="nextQuestion()" class="neon-button px-6 py-3 opacity-50 pointer-events-none">
            Next ‚Üí
          </button>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-section" class="hidden">
        <div class="text-center mb-8">
          <div class="text-6xl mb-4">‚ú®</div>
          <h2 class="text-4xl font-bold gradient-text mb-4">Your Personalized Recommendations</h2>
          <p class="text-gray-300">Based on your answers, here's what we recommend:</p>
        </div>

        <div id="gideon-message" class="gideon-plan-card hidden mb-10" aria-live="polite">
          <div class="gideon-plan-card__header">
            <div class="gideon-plan-card__avatar">
              <video src="media/gideon-lives.mp4" autoplay muted loop playsinline poster="images/portfolio/crm-platform.jpg"></video>
            </div>
            <div>
              <p class="gideon-plan-card__eyebrow">Gideon Recommends</p>
              <h3 id="gideon-headline" class="gideon-plan-card__headline">Dialing in your build...</h3>
            </div>
          </div>
          <p id="gideon-summary" class="gideon-plan-card__summary text-gray-300"></p>
          <ul id="gideon-bullets" class="gideon-plan-card__bullets text-gray-200"></ul>
          <div id="gideon-disclaimer" class="gideon-plan-card__disclaimer text-xs text-gray-500"></div>
        </div>

        <!-- Recommended Plan -->
        <div id="recommended-plan" class="cyber-card border-2 border-cyan-500 mb-8">
          <!-- Will be populated by JavaScript -->
        </div>

        <!-- Alternative Options -->
        <div id="alternative-plans" class="mb-8">
          <h3 class="text-2xl font-bold text-white mb-4">Other Options to Consider</h3>
          <div id="alternative-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- CTA Buttons -->
        <div class="text-center space-y-4">
          <a id="checkout-button" href="checkout.html" class="neon-button inline-block px-8 py-4 text-lg">
            Proceed to Checkout
          </a>
          <div>
            <a href="contact.html" class="text-cyan-400 hover:text-cyan-300 transition">
              Need help deciding? Talk to our team ‚Üí
            </a>
          </div>
          <div>
            <button onclick="restartQuestionnaire()" class="text-gray-400 hover:text-gray-300 transition text-sm">
              ‚Üê Start Over
            </button>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script>
    // Questionnaire data
    const questions = [
      {
        id: 1,
        text: "What type of business do you have?",
        options: [
          { value: "service", label: "Service-based (consulting, contracting, etc.)", weight: { website: 2, crm: 1 } },
          { value: "ecommerce", label: "E-commerce / Retail", weight: { website: 3, crm: 2 } },
          { value: "saas", label: "Software / SaaS", weight: { webapp: 3, crm: 2 } },
          { value: "local", label: "Local business (restaurant, salon, gym, etc.)", weight: { website: 2, crm: 1 } },
          { value: "other", label: "Other / Multiple", weight: { website: 2, crm: 1 } }
        ]
      },
      {
        id: 2,
        text: "What's your primary goal?",
        options: [
          { value: "leads", label: "Generate leads and get more customers", weight: { website: 2, seo: 2 } },
          { value: "brand", label: "Build my brand and online presence", weight: { website: 2, branding: 2 } },
          { value: "sales", label: "Sell products or services online", weight: { website: 3, ecommerce: 2 } },
          { value: "manage", label: "Manage customers and sales pipeline", weight: { crm: 3, website: 1 } },
          { value: "app", label: "Build a custom web/mobile application", weight: { webapp: 3, mobileapp: 2 } }
        ]
      },
      {
        id: 3,
        text: "How many pages do you need on your website?",
        options: [
          { value: "1-5", label: "1-5 pages (simple presence)", weight: { tier: "starter" } },
          { value: "6-10", label: "6-10 pages (standard site)", weight: { tier: "growth" } },
          { value: "11-20", label: "11-20 pages (extensive content)", weight: { tier: "domination" } },
          { value: "20+", label: "20+ pages (large site)", weight: { tier: "domination" } },
          { value: "unsure", label: "Not sure yet", weight: { tier: "growth" } }
        ]
      },
      {
        id: 4,
        text: "Do you want ongoing maintenance and updates?",
        options: [
          { value: "yes", label: "Yes, I want monthly support and updates", weight: { monthly: 3 } },
          { value: "no", label: "No, just build it and I'll manage it myself", weight: { onetime: 3 } },
          { value: "maybe", label: "Maybe later, but not right now", weight: { onetime: 2 } }
        ]
      },
      {
        id: 5,
        text: "What's your budget range?",
        options: [
          { value: "under-3k", label: "Under $3,000", weight: { tier: "starter", onetime: 2 } },
          { value: "3k-5k", label: "$3,000 - $5,000", weight: { tier: "growth" } },
          { value: "5k-10k", label: "$5,000 - $10,000", weight: { tier: "domination" } },
          { value: "10k+", label: "$10,000+", weight: { tier: "domination", webapp: 2 } },
          { value: "flexible", label: "Flexible / Not sure", weight: { tier: "growth" } }
        ]
      }
    ];

    // Service packages
    const packages = {
      'website-starter-onetime': {
        name: 'Website Starter (One-Time)',
        price: '$2,497',
        recurring: null,
        features: [
          'Up to 5 pages',
          'Mobile responsive design',
          'Contact form',
          'Basic SEO setup',
          '30 days post-launch support'
        ],
        description: 'Perfect for small businesses that need a simple online presence',
        checkoutUrl: 'plan-details.html?plan=website-starter-onetime'
      },
      'website-starter-monthly': {
        name: 'Website Starter (Monthly)',
        price: '$497',
        recurring: '$212.50/mo',
        features: [
          'Up to 5 pages',
          'Mobile responsive design',
          'Contact form',
          'Hosting included',
          'Monthly updates',
          'Security monitoring',
          'Ongoing support'
        ],
        description: 'Lower upfront cost with ongoing support and updates (24-month contract)',
        checkoutUrl: 'plan-details.html?plan=website-starter-monthly'
      },
      'website-growth-onetime': {
        name: 'Website Growth (One-Time)',
        price: '$3,497',
        recurring: null,
        features: [
          'Up to 10 pages',
          'Advanced SEO',
          'Newsletter signup',
          'Social media integration',
          '60 days post-launch support'
        ],
        description: 'Best for growing businesses that need more content and features',
        checkoutUrl: 'plan-details.html?plan=website-growth-onetime'
      },
      'website-growth-monthly': {
        name: 'Website Growth (Monthly)',
        price: '$697',
        recurring: '$212.50/mo',
        features: [
          'Up to 10 pages',
          'Mobile responsive',
          'Advanced forms',
          'Enhanced SEO',
          'Blog setup',
          'Hosting included',
          'Weekly updates',
          'Security monitoring',
          'Priority support'
        ],
        description: 'Most popular option for serious businesses (24-month contract)',
        checkoutUrl: 'plan-details.html?plan=website-growth-monthly',
        recommended: true
      },
      'website-domination-onetime': {
        name: 'Website Domination (One-Time)',
        price: '$4,997',
        recurring: null,
        features: [
          'Unlimited pages',
          'E-commerce ready',
          'Blog/news system',
          'Advanced integrations',
          '90 days post-launch support'
        ],
        description: 'Complete solution for businesses that want it all',
        checkoutUrl: 'plan-details.html?plan=website-domination-onetime'
      },
      'website-domination-monthly': {
        name: 'Website Domination (Monthly)',
        price: '$997',
        recurring: '$252.50/mo',
        features: [
          'Unlimited pages',
          'Mobile responsive',
          'Custom features',
          'Premium SEO',
          'E-commerce ready',
          'Blog + CMS',
          'Hosting included',
          'Daily monitoring',
          '24/7 support'
        ],
        description: 'Enterprise-level website with maximum support (24-month contract)',
        checkoutUrl: 'plan-details.html?plan=website-domination-monthly'
      },
      'crm-platform': {
        name: 'Gideon Code CRM Platform',
        price: 'Custom',
        recurring: 'Starting at $97/mo',
        features: [
          'Sales pipeline management',
          'Commission tracking',
          'Team management',
          'Real-time analytics',
          'Mobile access',
          'Custom integrations'
        ],
        description: 'Perfect for businesses that need to manage their sales team',
        checkoutUrl: 'plan-details.html?plan=crm-platform'
      },
      'webapp-saas': {
        name: 'SaaS / Dashboard Application',
        price: 'Starting at $19,997',
        recurring: null,
        features: [
          'Custom user dashboards',
          'Data visualization & reporting',
          'User authentication & roles',
          'Database design & setup',
          'API development',
          'Responsive web design',
          '90 days support'
        ],
        description: 'Perfect for businesses that need custom SaaS products or data dashboards',
        checkoutUrl: 'contact.html'
      },
      'webapp-crm-internal': {
        name: 'CRM / Internal Tools',
        price: 'Starting at $14,997',
        recurring: null,
        features: [
          'Custom workflow automation',
          'Sales pipeline management',
          'Contact & lead tracking',
          'Reporting & analytics',
          'Email integrations',
          'User permissions & security',
          '90 days support'
        ],
        description: 'Perfect for businesses that need custom internal tools or CRM systems',
        checkoutUrl: 'contact.html'
      }
    };

    // State
    let currentQuestionIndex = 0;
    let answers = {};
    let scores = {
      website: 0,
      crm: 0,
      webapp: 0,
      mobileapp: 0,
      branding: 0,
      seo: 0,
      ecommerce: 0,
      monthly: 0,
      onetime: 0,
      tier: { starter: 0, growth: 0, domination: 0 }
    };

    function startQuestionnaire() {
      document.getElementById('intro-section').classList.add('hidden');
      document.getElementById('questionnaire-section').classList.remove('hidden');
      document.getElementById('total-questions').textContent = questions.length;
      showQuestion(0);
    }

    function showQuestion(index) {
      currentQuestionIndex = index;
      const question = questions[index];

      document.getElementById('current-question').textContent = index + 1;
      document.getElementById('question-text').textContent = question.text;

      // Update progress bar
      const progress = ((index + 1) / questions.length) * 100;
      document.getElementById('progress-bar').style.width = progress + '%';

      // Render options
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';

      question.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-button w-full text-left p-4 rounded-lg border-2 border-gray-700 hover:border-cyan-500 transition-all duration-200';
        button.innerHTML = `
          <div class="flex items-center">
            <div class="flex-shrink-0 w-6 h-6 rounded-full border-2 border-gray-600 mr-4 option-radio"></div>
            <div class="text-white">${option.label}</div>
          </div>
        `;

        if (answers[question.id]?.value === option.value) {
          button.classList.add('selected');
        }

        button.addEventListener('click', (event) => selectOption(question.id, option, event.currentTarget));
        optionsContainer.appendChild(button);
      });

      // Update navigation buttons
      const backButton = document.getElementById('back-button');
      const nextButton = document.getElementById('next-button');

      if (index === 0) {
        backButton.classList.add('opacity-50', 'pointer-events-none');
      } else {
        backButton.classList.remove('opacity-50', 'pointer-events-none');
      }

      if (answers[question.id]) {
        nextButton.classList.remove('opacity-50', 'pointer-events-none');
      } else {
        nextButton.classList.add('opacity-50', 'pointer-events-none');
      }
    }

    function selectOption(questionId, option, buttonElement) {
      answers[questionId] = {
        value: option.value,
        weight: option.weight,
        label: option.label
      };

      recalculateScores();

      const container = document.getElementById('options-container');
      container.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));
      buttonElement.classList.add('selected');

      document.getElementById('next-button').classList.remove('opacity-50', 'pointer-events-none');
    }

    function recalculateScores() {
      scores = {
        website: 0,
        crm: 0,
        webapp: 0,
        mobileapp: 0,
        branding: 0,
        seo: 0,
        ecommerce: 0,
        monthly: 0,
        onetime: 0,
        tier: { starter: 0, growth: 0, domination: 0 }
      };

      Object.values(answers).forEach(answer => {
        if (!answer) return;
        const weight = answer.weight || {};
        Object.keys(weight).forEach(key => {
          if (key === 'tier') {
            const tierKey = weight[key];
            if (scores.tier[tierKey] !== undefined) {
              scores.tier[tierKey] += 1;
            }
          } else {
            scores[key] = (scores[key] || 0) + weight[key];
          }
        });
      });
    }

    function nextQuestion() {
      if (currentQuestionIndex < questions.length - 1) {
        showQuestion(currentQuestionIndex + 1);
      } else {
        showResults();
      }
    }

    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        showQuestion(currentQuestionIndex - 1);
      }
    }

    function showResults() {
      recalculateScores();
      document.getElementById('questionnaire-section').classList.add('hidden');
      document.getElementById('results-section').classList.remove('hidden');

      let recommendedKey;
      let recommendedPackage;

      if (scores.webapp >= 3) {
        recommendedKey = scores.webapp >= 5 ? 'webapp-saas' : 'webapp-crm-internal';
        recommendedPackage = packages[recommendedKey];
      } else if (scores.crm >= 4) {
        recommendedKey = 'crm-platform';
        recommendedPackage = packages[recommendedKey];
      } else {
        let tier = 'growth';
        if (scores.tier.starter >= scores.tier.growth && scores.tier.starter >= scores.tier.domination) {
          tier = 'starter';
        } else if (scores.tier.domination > scores.tier.growth) {
          tier = 'domination';
        }

        const isMonthly = scores.monthly > scores.onetime;
        const suffix = isMonthly ? 'monthly' : 'onetime';
        recommendedKey = `website-${tier}-${suffix}`;
        recommendedPackage = packages[recommendedKey];
      }

      if (!recommendedPackage) {
        recommendedKey = 'website-growth-monthly';
        recommendedPackage = packages[recommendedKey];
      }

      const recommendedDiv = document.getElementById('recommended-plan');
      recommendedDiv.innerHTML = `
        <div class="mb-4">
          <span class="inline-block bg-cyan-500 text-black text-xs font-bold px-3 py-1 rounded-full mb-4">RECOMMENDED FOR YOU</span>
          <h3 class="text-3xl font-bold text-cyan-400 mb-2">${recommendedPackage.name}</h3>
          <p class="text-gray-300 mb-4">${recommendedPackage.description}</p>
        </div>
        <div class="mb-6">
          <div class="text-4xl font-bold text-white mb-2">
            ${recommendedPackage.price}
            ${recommendedPackage.recurring ? `<span class="text-lg text-gray-400">+ ${recommendedPackage.recurring}</span>` : ''}
          </div>
        </div>
        <ul class="space-y-3 mb-8">
          ${recommendedPackage.features.map(f => `<li class="flex items-start"><span class="text-cyan-400 mr-2">‚úì</span><span class="text-gray-300">${f}</span></li>`).join('')}
        </ul>
        <a id="recommended-cta" href="${recommendedPackage.checkoutUrl}" class="neon-button w-full text-center block">
          Select This Plan
        </a>
      `;

      const alternativeGrid = document.getElementById('alternative-grid');
      const alternatives = buildAlternativeList(recommendedKey);
      alternativeGrid.innerHTML = alternatives.map(({ pkg }) => `
        <div class="cyber-card">
          <h4 class="text-xl font-bold text-white mb-2">${pkg.name}</h4>
          <div class="text-2xl font-bold text-cyan-400 mb-4">
            ${pkg.price}
            ${pkg.recurring ? `<span class="text-sm text-gray-400">+ ${pkg.recurring}</span>` : ''}
          </div>
          <ul class="space-y-2 mb-6 text-sm">
            ${pkg.features.slice(0, 4).map(f => `<li class="text-gray-400">‚úì ${f}</li>`).join('')}
          </ul>
          <a href="${pkg.checkoutUrl}" class="neon-button-outline w-full text-center block text-sm">
            Select
          </a>
        </div>
      `).join('');

      document.getElementById('checkout-button').href = recommendedPackage.checkoutUrl;

      showGideonLoading();
      const recommendedCta = document.getElementById('recommended-cta');
      const planPayload = buildPlanPayload(recommendedKey, recommendedPackage, alternatives);
      fetchGideonNarrative(planPayload, recommendedCta);
    }

    function buildAlternativeList(recommendedKey) {
      const items = [];
      const isWebapp = recommendedKey.startsWith('webapp-');
      const isCrm = recommendedKey === 'crm-platform';

      Object.keys(packages).forEach(key => {
        if (key === recommendedKey || items.length >= 3) return;

        if (isWebapp) {
          if (key.startsWith('webapp-') || key === 'crm-platform') {
            items.push({ key, pkg: packages[key] });
          }
        } else if (isCrm) {
          if (key.startsWith('website-') || key.startsWith('webapp-')) {
            items.push({ key, pkg: packages[key] });
          }
        } else {
          if (key.startsWith('website-')) {
            items.push({ key, pkg: packages[key] });
          } else if (key === 'crm-platform' && items.length < 2) {
            items.push({ key, pkg: packages[key] });
          }
        }
      });

      return items;
    }

    function buildPlanPayload(recommendedKey, recommendedPackage, alternatives) {
      const payloadAlternatives = (alternatives || []).slice(0, 2).map(item => ({
        id: item.key,
        name: item.pkg.name,
        summary: item.pkg.description,
        checkoutUrl: item.pkg.checkoutUrl
      }));

      return {
        businessType: answers[1]?.label || '',
        primaryGoal: answers[2]?.label || '',
        siteScale: answers[3]?.label || '',
        maintenance: answers[4]?.label || '',
        budget: answers[5]?.label || '',
        recommendedPlan: {
          id: recommendedKey,
          name: recommendedPackage.name,
          price: recommendedPackage.price,
          recurring: recommendedPackage.recurring,
          type: recommendedKey.split('-')[0],
          billing: recommendedPackage.recurring ? 'monthly' : 'one-time',
          summary: recommendedPackage.description,
          checkoutUrl: recommendedPackage.checkoutUrl
        },
        alternatives: payloadAlternatives,
        tags: buildPlanTags()
      };
    }

    function buildPlanTags() {
      const tags = [];
      if (scores.crm >= 3) tags.push('crm');
      if (scores.webapp >= 3) tags.push('webapp');
      tags.push(scores.monthly > scores.onetime ? 'prefers_monthly' : 'prefers_onetime');

      const tierEntries = Object.entries(scores.tier || {});
      if (tierEntries.length) {
        const [topTier] = tierEntries.sort((a, b) => b[1] - a[1])[0];
        tags.push(`${topTier}_tier`);
      }

      if (scores.branding >= 2) tags.push('branding');
      if (scores.seo >= 2) tags.push('seo');
      if (scores.ecommerce >= 2) tags.push('ecommerce');

      return tags.filter(Boolean);
    }

    function showGideonLoading() {
      const container = document.getElementById('gideon-message');
      const bulletsEl = document.getElementById('gideon-bullets');
      container.classList.remove('hidden');
      document.getElementById('gideon-headline').textContent = 'Dialing in your build...';
      document.getElementById('gideon-summary').textContent = 'Pushing your inputs through Gideon so the plan matches your revenue target.';
      bulletsEl.innerHTML = '<li class="text-gray-400">Syncing Claude + GPT-4 signals...</li>';
      document.getElementById('gideon-disclaimer').textContent = '';
    }

    async function fetchGideonNarrative(payload, recommendedCta) {
      try {
        const response = await fetch('/.netlify/functions/ai-gateway', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ kind: 'plan', payload })
        });

        if (!response.ok) {
          throw new Error(`Gateway ${response.status}`);
        }

        const data = await response.json();
        renderGideonMessage(data, recommendedCta);
      } catch (error) {
        console.error('Gideon plan narrative failed:', error);
        renderGideonFallback(recommendedCta);
      }
    }

    function renderGideonMessage(data, recommendedCta) {
      const headline = data.headline || 'Let‚Äôs build the machine that prints your revenue.';
      const summary = data.summary || 'We‚Äôll lock in the stack, wire Gideon to it, and get the pipeline compounding fast.';
      const bullets = Array.isArray(data.bullets) && data.bullets.length ? data.bullets : [
        'Gideon runs analytics, outreach, and follow-up loops',
        '50% deposit today, balance at launch sign-off',
        'Scope locks before kickoff so there are no surprises'
      ];
      const disclaimer = data.disclaimer || 'Scope validated post-discovery. Change orders apply if new requirements surface. 50% deposit due now.';

      document.getElementById('gideon-headline').textContent = headline;
      document.getElementById('gideon-summary').textContent = summary;
      document.getElementById('gideon-bullets').innerHTML = bullets.map(item => `<li>${item}</li>`).join('');
      document.getElementById('gideon-disclaimer').textContent = disclaimer.toUpperCase();

      if (data.ctaLabel && recommendedCta) {
        recommendedCta.textContent = data.ctaLabel;
      }
    }

    function renderGideonFallback(recommendedCta) {
      document.getElementById('gideon-headline').textContent = 'We already know how to ship this.';
      document.getElementById('gideon-summary').textContent = 'Even if the AI feed lags, we have the sprint map. Lock the slot and we‚Äôll finalize scope on kickoff.';
      document.getElementById('gideon-bullets').innerHTML = [
        'Discovery call locks the feature list before we write a line of code',
        'Any extra scope runs through a change order before work starts',
        '50% deposit today. Balance after delivery sign-off'
      ].map(item => `<li>${item}</li>`).join('');
      document.getElementById('gideon-disclaimer').textContent = 'Scope validated at intake. Change orders issued if requirements expand.';

      if (recommendedCta) {
        recommendedCta.textContent = 'Lock My Slot';
      }
    }

    function restartQuestionnaire() {
      currentQuestionIndex = 0;
      answers = {};
      scores = {
        website: 0,
        crm: 0,
        webapp: 0,
        mobileapp: 0,
        branding: 0,
        seo: 0,
        ecommerce: 0,
        monthly: 0,
        onetime: 0,
        tier: { starter: 0, growth: 0, domination: 0 }
      };
      recalculateScores();

      document.getElementById('results-section').classList.add('hidden');
      document.getElementById('intro-section').classList.remove('hidden');
      document.getElementById('gideon-message').classList.add('hidden');
      document.getElementById('gideon-bullets').innerHTML = '';
      document.getElementById('gideon-summary').textContent = '';
      document.getElementById('gideon-disclaimer').textContent = '';
    }
  </script>

  <style>
    .option-button.selected {
      border-color: #06b6d4;
      background: rgba(6, 182, 212, 0.1);
    }

    .option-button.selected .option-radio {
      border-color: #06b6d4;
      background: #06b6d4;
      position: relative;
    }

    .option-button.selected .option-radio::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }
  </style>

  <script src="js/main.js?v=4" defer></script>
  </body>
</html>
